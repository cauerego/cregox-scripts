<script src="https://cdn.rawgit.com/cregox/endless-scrolling/1.0/endless-scrolling.min.js"></script>

<!--
 remove includes from here, and into js
 http://stackoverflow.com/a/10939737/274502
-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/masonry/3.3.0/masonry.pkgd.min.js"></script>
<script src="https://cdn.rawgit.com/desandro/imagesloaded/master/imagesloaded.pkgd.min.js"></script>
<script src="https://cdn.rawgit.com/aFarkas/lazysizes/gh-pages/lazysizes.min.js"></script>
<style>
  .summary-item-list {
    display: none;
  }
</style>
<script name="endless scrolling" author="cregox.com">
  Y.use('node', function()
  {
    Y.on('domready', function()
    {
      // enable Custom CSS to work on editor
      Y.one('main#main').addClass('endless-scrolling');

      // prevent script from running in squarespace editor
      if (window.top.document !== window.document)
      {
        // with style, prevented summary to appear
        Y.one('main#main .summary-item-list').setStyle('display', 'block');
        return;
      }
    
      Y.one('footer#footer').hide().setStyles({
        'position': 'absolute',
        'bottom': 0,
        'left': '50px',
        'right': '50px'
      });

      // settings
      endlessScrolling({
        'thumbSize': 300,
        'loadingMargin': 500,
        'container': 'main#main .wrapper',
        'item': '.summary-item',
        'onComplete': setMouseHover // how to send parameter?
      });

      setMouseHover( Y.one('main#main .wrapper div') );

      function cacheAjaxRequest ()
      {
        if (jsonCachedRequest === null)
        {
          // ajax request
          Y.io('/shop?format=json', {
            on: {
              success: function (x, o) {
                try {
                  json = Y.JSON.parse(o.responseText);
                } catch (e) {
                  console.log("JSON Parse failed!");
                  return;
                }

                // when done loading json

                jsonCachedRequest = json;
                totalItemsCount = json.items.length;

                resetScrollingVars();

                Y.one('body').simulate('resize'); // adjust items in the columns

                createLayout();
                loadMasonry();
              }
            }
          });
        }
      } // function cacheAjaxRequest

      // make it look like the original shop
      function setMouseHover (Ynode)
      {
        Ynode.all('.summary-item img').on('mouseenter', function(e)
        {
          e.currentTarget.transition(
            {
              duration:0.5,
              opacity:0.5
            });
        });
        Ynode.all('.summary-item img').on('mouseleave', function(e)
        {
          e.currentTarget.transition(
            {
              duration:0.5,
              opacity:1
            });
        });
      } // function setMouseHover
    })
  });
</script>